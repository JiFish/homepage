let t="tiny_garden_save_v1",e=["mud","grass","water","sand","stone"],a={mud:"#604834",grass:"#448c4a",water:"#3860a4",sand:"#c6b670",stone:"#aaaaaa"};function l(){let t=[];for(let e=0;e<30;e++){let e=[];for(let t=0;t<40;t++)e.push(null);t.push(e)}return t}function r(t,e){return t>=0&&t<40&&e>=0&&e<30}function n(t,e){return[[t+1,e],[t-1,e],[t,e+1],[t,e-1]]}function i(t,e){let a=[];for(let l=-1;l<=1;l++)for(let r=-1;r<=1;r++)(0!==r||0!==l)&&a.push([t+r,e+l]);return a}function o(t,e,a){return Math.max(e,Math.min(a,t))}function s(t){let e=t>>>0;return function(){let t=e+=0x6d2b79f5;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/0x100000000}}class g{static typeName="plant";static displayName="Plant";static maxStage=3;static getDescription(t,e,a){return this.displayName}static canPlantOn(t,e,a){return!1}static init(t,e,a){return{}}static plant(t,e,a){a.plantGrid[e][t]={plantType:this.typeName,stage:0,age:0,data:this.init(t,e,a)}}static onTick(t,e,a){let l=a.plantGrid[e][t];l&&(l.age+=1,l.stage<this.maxStage&&l.age%3==0&&(l.stage+=1))}static draw(t,e,a,l){ctx.strokeStyle="rgba(0,0,0,0.9)",ctx.lineWidth=1,ctx.strokeRect(px,py,TILE_SIZE,TILE_SIZE)}static _countPlantsInRadius(t,e,a,l,n){let i=0;for(let o=a-l;o<=a+l;o++)for(let a=e-l;a<=e+l;a++){if(!r(a,o))continue;let e=n.plantGrid[o][a];e&&e.plantType===t&&i++}return i}static _countPlantsInMoore(t,e,a,l){let n=0;for(let i=-1;i<=1;i++)for(let o=-1;o<=1;o++){if(0===o&&0===i)continue;let s=e+o,g=a+i;if(!r(s,g))continue;let c=l.plantGrid[g][s];c&&c.plantType===t&&n++}return n}static _isCrowdedForSpreading(t,e,a){let l=0;for(let[n,o]of i(t,e))r(n,o)&&a.plantGrid[o][n]&&l++;return l>=5}static _trySpreadTo(t,e,a,l,n,i,o){return!(!r(l,n)||o.plantGrid[n][l]||!i(l,n,o)||this._isCrowdedForSpreading(l,n,o))&&(this.plant(l,n,o),!0)}}class c extends g{static typeName="reed";static displayName="Reed";static maxStage=4;static canPlantOn(t,e,a){let l=a.baseGrid[e][t];return"mud"===l||"water"===l&&!c._isDeepWaterPocket(t,e,a)}static _isDeepWaterPocket(t,e,a){if("water"!==a.baseGrid[e][t])return!1;for(let[l,n]of i(t,e))if(!r(l,n)||"water"!==a.baseGrid[n][l])return!1;return!0}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l)return;l.age+=1;let i="water"===a.baseGrid[e][t]?2:3;if(l.stage<this.maxStage&&l.age%i==0&&(l.stage+=1),l.stage<3||l.age%5!=0)return;let o="water"===a.baseGrid[e][t]?10:7,s=this._countPlantsInRadius(this.typeName,t,e,2,a);if(s>=o)return;let g=n(t,e).filter(([t,e])=>r(t,e));for(let t=g.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[g[t],g[e]]=[g[e],g[t]]}if(!(a.rng()>.45*(1-s/o))){for(let[l,r]of g.slice().sort((t,e)=>("water"!==a.baseGrid[t[1]][t[0]])-("water"!==a.baseGrid[e[1]][e[0]])))if(this._trySpreadTo(this.typeName,t,e,l,r,this.canPlantOn,a))break}}static draw(t,e,a,l){let r=a+20-4,n=r-(Math.floor((l.stage+1)/(this.maxStage+1)*12)+6),i=e+Math.floor(10);t.lineWidth=2,t.strokeStyle="rgb(60,170,90)",t.beginPath(),t.moveTo(i,r),t.lineTo(i,n),t.stroke(),t.strokeStyle="rgb(80,220,120)",t.beginPath(),t.moveTo(i,n+6),t.lineTo(i+6,n+2),t.moveTo(i,n+10),t.lineTo(i-6,n+6),t.stroke()}}class d extends g{static typeName="daisy";static displayName="Daisy";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.color+")"}static init(t,e,a){return{color:"white"}}static canPlantOn(t,e,a){let l=a.baseGrid[e][t];return"grass"===l||"mud"===l}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%3==0&&(l.stage+=1),l.stage<this.maxStage||l.age%6!=0||this._countPlantsInMoore(this.typeName,t,e,a)>=3))return;let n=i(t,e).filter(([t,e])=>r(t,e));for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}if(n.sort((t,e)=>this._countPlantsInMoore(this.typeName,t[0],t[1],a)-this._countPlantsInMoore(this.typeName,e[0],e[1],a)),a.rng()>.55)return;let o=l.data?.color??"white",s=o;if(.08>a.rng()){let t=["white","yellow","pink","lavender"].filter(t=>t!==o);s=t[Math.floor(a.rng()*t.length)]}for(let[l,r]of n)if(!(this._countPlantsInMoore(this.typeName,l,r,a)>=2)&&this._trySpreadTo(this.typeName,t,e,l,r,this.canPlantOn,a)){let t=a.plantGrid[r][l];t&&(t.data={...t.data||{},color:s});break}}static draw(t,e,a,l){let r=e+10,n=a+10;t.lineWidth=2,t.strokeStyle="rgb(70,180,90)",t.beginPath(),t.moveTo(r,a+20-4),t.lineTo(r,n),t.stroke();let i=2+l.stage,o=2+Math.max(0,l.stage-1),s={white:"rgb(240,240,240)",yellow:"rgb(246, 255, 163)",pink:"rgb(80, 160, 230)",lavender:"rgb(220, 208, 255)"},g=s[l.data?.color]??s.white;if(l.stage>=1)for(let[e,a]of(t.fillStyle=g,[[0,-5],[5,0],[0,5],[-5,0],[4,-4],[-4,-4],[4,4],[-4,4]]))t.beginPath(),t.arc(r+e,n+a,i,0,2*Math.PI),t.fill();t.fillStyle="rgb(240,210,60)",t.beginPath(),t.arc(r,n,Math.max(2,o),0,2*Math.PI),t.fill()}}class f extends g{static typeName="cactus";static displayName="Cactus";static maxStage=4;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.colour+" flower)"}static canPlantOn(t,e,a){return"sand"===a.baseGrid[e][t]}static init(t,e,a){let l=["red","yellow","blue","green","cyan","magenta"];return{colour:l[Math.floor(a.rng()*l.length)],flowering:!1,bloomAge:0}}static _colourToRGB(t){return({red:"rgb(255, 70, 70)",yellow:"rgb(255, 235, 90)",blue:"rgb(80, 140, 255)",green:"rgb(90, 255, 130)",cyan:"rgb(90, 245, 255)",magenta:"rgb(255, 90, 235)"})[t]||"rgb(255, 255, 255)"}static _pickSpreadTarget(t,e,a){let l=[];for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++){if(0===i&&0===n)continue;let o=t+i,s=e+n;if(!r(o,s)||a.plantGrid[s][o]||!this.canPlantOn(o,s,a))continue;let g=this._countPlantsInRadius(this.typeName,o,s,1,a);if(g>=3)continue;let c=0===g?6:1===g?3:1;l.push({nx:o,ny:s,weight:c})}if(0===l.length)return null;let n=0;for(let t of l)n+=t.weight;let i=a.rng()*n;for(let t of l)if((i-=t.weight)<=0)return[t.nx,t.ny];return[l[0].nx,l[0].ny]}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%4==0&&(l.stage+=1),l.stage<2))return;let r=this._countPlantsInRadius(this.typeName,t,e,2,a);if(l.data.flowering){l.data.bloomAge+=1;let t=Math.min(.45,.06*l.data.bloomAge);if(a.rng()<.12+t){l.data.flowering=!1,l.data.bloomAge=0;return}}else{let t=.06-Math.min(.12,.02*r);t>0&&a.rng()<t&&(l.data.flowering=!0,l.data.bloomAge=0)}if(!l.data.flowering||this._countPlantsInRadius(this.typeName,t,e,3,a)>=10||a.rng()>.75)return;let n=this._pickSpreadTarget(t,e,a);if(!n)return;let[i,o]=n;this.plant(i,o,a);let s=l.data.colour;if(.08>a.rng()){let t=["red","yellow","blue","green","cyan","magenta"].filter(t=>t!==l.data.colour);s=t[Math.floor(a.rng()*t.length)]}let g=a.plantGrid[o][i];g.data.colour=s,g.data.flowering=!1,g.data.bloomAge=0}static draw(t,e,a,l){let r,n=Math.floor((l.stage+1)/(this.maxStage+1)*10)+10,i=e+5,s=a+(20-n-4);t.fillStyle="rgb(60,160,110)",r=o(6,0,Math.min(10,n)/2),t.beginPath(),t.moveTo(i+r,s),t.arcTo(i+10,s,i+10,s+n,r),t.arcTo(i+10,s+n,i,s+n,r),t.arcTo(i,s+n,i,s,r),t.arcTo(i,s,i+10,s,r),t.closePath(),t.fill(),t.strokeStyle="rgba(255,255,255,0.85)",t.lineWidth=1;for(let e=0;e<3;e++){let a=i+Math.floor((e+1)*10/4),l=s+6,r=s+n-6;for(let n=l;n<=r;n+=6){let l=(e+Math.floor(n/6))%2==0?-1:1;t.beginPath(),t.moveTo(a,n),t.lineTo(a+2*l,n+2),t.stroke()}}if(l.data.flowering){let a=this._colourToRGB(l.data.colour),r=e+10,n=s+4;for(let[e,l]of(t.fillStyle=a,[[0,-3],[3,0],[0,3],[-3,0],[2,-2],[-2,-2],[2,2],[-2,2]]))t.beginPath(),t.arc(r+e,n+l,2,0,2*Math.PI),t.fill();t.fillStyle="rgb(255, 235, 90)",t.beginPath(),t.arc(r,n,2,0,2*Math.PI),t.fill()}}}class u extends g{static typeName="chromatic";static displayName="Chromatic";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.base+")"}static init(t,e,a){return{base:a.baseGrid[e][t]}}static canPlantOn(t,e,a){return!0}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%3==0&&(l.stage+=1),l.stage<this.maxStage||l.age%7!=0||this._countPlantsInRadius(this.typeName,t,e,2,a)>=6||a.rng()>.25))return;let n=i(t,e).filter(([t,e])=>r(t,e));for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let[t,e]of n)if(!a.plantGrid[e][t]&&!this._isCrowdedForSpreading(t,e,a)){this.plant(t,e,a);break}}static draw(t,e,a,l){let r={mud:"rgb(160, 110, 80)",grass:"rgb(80, 200, 110)",water:"rgb(80, 160, 230)",sand:"rgb(240, 210, 120)",stone:"rgb(109, 109, 109)"}[l.data.base]||"rgb(180, 180, 180)",n=e+10,i=a+10,o=Math.max(3,Math.floor(20/7)+2*l.stage);t.fillStyle=r,t.beginPath(),t.arc(n,i,o,0,2*Math.PI),t.fill(),l.stage>=2&&(t.strokeStyle="rgba(0,0,0,0.25)",t.lineWidth=2,t.beginPath(),t.arc(n,i,o-2,0,2*Math.PI),t.stroke())}}class h extends g{static typeName="wanderer";static displayName="Wanderer";static maxStage=2;static init(t,e,a){return{moved:!1}}static canPlantOn(t,e,a){let l=a.baseGrid[e][t];return"water"!==l&&"mud"!==l}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%3==0&&(l.stage+=1),l.stage<this.maxStage||l.age%4!=0||l.moved||a.rng()>.75))return;let i=n(t,e).filter(([t,e])=>r(t,e)),o=[];for(let[t,e]of i){let l=a.plantGrid[e][t];l&&l.plantType===this.typeName&&l.stage===this.maxStage&&o.push([t,e])}if(0===o.length)return;let s=[];for(let[t,e]of i)!a.plantGrid[e][t]&&this.canPlantOn(t,e,a)&&s.push([t,e]);if(0===s.length)return;let[g,c]=s[Math.floor(a.rng()*s.length)];a.plantGrid[c][g]={plantType:this.typeName,stage:0,age:0};let[d,f]=o[Math.floor(a.rng()*o.length)];a.plantGrid[f][d]=null,l.moved=!0,a.magic+=1}static draw(t,e,a,l){let r=e+10,n=a+10,i=4+2*l.stage;t.fillStyle="rgb(170, 110, 210)",t.beginPath(),t.arc(r,n,i,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0,0,0,0.65)",t.beginPath(),t.arc(r+2,n-1,Math.max(1,i-4),0,2*Math.PI),t.fill()}}class p extends g{static typeName="blight";static displayName="Blight";static maxStage=1;static canPlantOn(t,e,a){return!0}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage=1,l.age%2!=0))return;let n=i(t,e).filter(([t,e])=>r(t,e));if(0!==n.length){for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let[t,e]of n){let l=a.plantGrid[e][t];if(!l||l.plantType===this.typeName||"fence"===l.plantType)continue;let r=G[l.plantType];if(r&&l.stage===r.maxStage){a.plantGrid[e][t]={plantType:this.typeName,stage:1,age:0};break}}a.rng()>.9&&(a.plantGrid[e][t]=null)}}static draw(t,e,a,l){let r=e+10,n=a+10;t.fillStyle="rgb(10, 40, 90)",t.beginPath(),t.arc(r,n,Math.floor(20/3),0,2*Math.PI),t.fill(),t.strokeStyle="rgb(150, 80, 80)",t.lineWidth=2,t.beginPath(),t.arc(r,n,Math.floor(20/3)-2,0,2*Math.PI),t.stroke()}}class m extends g{static typeName="mushroom";static displayName="Mushroom";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return`${this.displayName} (${l.data.cap} cap)`}static canPlantOn(t,e,a){let l=a.baseGrid[e][t];return"grass"===l||"mud"===l}static init(t,e,a){return{cap:"brown"}}static _pickCapWeighted(t){let e=[["brown",40],["tan",18],["cream",14],["red",10],["orange",8],["yellow",7],["purple",5],["blue",3],["black",2],["white",2],["glow",1]],a=0;for(let[,t]of e)a+=t;let l=t.rng()*a;for(let[t,a]of e)if((l-=a)<=0)return t;return"brown"}static _countHostileAdjacency(t,e,a){let l=0;for(let[n,o]of i(t,e)){if(!r(n,o))continue;let t=a.plantGrid[o][n];t&&t.plantType!==this.typeName&&"fence"!==t.plantType&&l++}return l}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%4==0&&(l.stage+=1),l.stage<this.maxStage||l.age<24||l.age%4!=0))return;let n=[];for(let[l,o]of i(t,e))r(l,o)&&this.canPlantOn(l,o,a)&&!a.plantGrid[o][l]&&(this._countHostileAdjacency(l,o,a)>=3||n.push([l,o]));if(!(n.length<4))for(let[r,i]of(a.plantGrid[e][t]=null,n)){if(a.rng()>.45)continue;this.plant(r,i,a);let t=a.plantGrid[i][r];t&&(a.rng()>.9?t.data.cap=this._pickCapWeighted(a):t.data.cap=l.data.cap)}}static draw(t,e,a,l){let r=e+10,n=a+20,i=3*l.stage,o=3+2*l.stage,s={brown:"rgb(140, 90, 60)",tan:"rgb(190, 150, 105)",cream:"rgb(220, 210, 190)",red:"rgb(190, 60, 60)",orange:"rgb(235, 140, 70)",yellow:"rgb(245, 225, 90)",purple:"rgb(150, 110, 190)",blue:"rgb(90, 140, 255)",black:"rgb(35, 35, 35)",white:"rgb(245, 245, 245)",glow:"rgb(120, 255, 210)"},g=s[l.data.cap]??s.brown;if(t.fillStyle="rgb(220, 210, 190)",t.fillRect(r-Math.floor(1.5),n-i,3,i),t.fillStyle=g,t.beginPath(),t.arc(r,n-i,o,Math.PI,0),t.closePath(),t.fill(),l.stage>=2)for(let[e,a]of(t.fillStyle="rgba(255,255,255,0.75)",[[-2,-1],[2,-2],[0,-3]]))t.beginPath(),t.arc(r+e,n-i+a,1,0,2*Math.PI),t.fill()}}class y extends g{static typeName="lichen";static displayName="Lichen";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.hue+")"}static canPlantOn(t,e,a){return"stone"===a.baseGrid[e][t]}static init(t,e,a){let l=["mint","teal","gold","rust"];return{hue:l[Math.floor(a.rng()*l.length)]}}static _hueToColour(t){return({mint:"rgb(150, 230, 170)",teal:"rgb(90, 210, 200)",gold:"rgb(235, 210, 120)",rust:"rgb(210, 140, 90)"})[t]||"rgb(200, 200, 200)"}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%6==0&&(l.stage+=1),l.stage<this.maxStage||l.age%7!=0||this._countPlantsInRadius(this.typeName,t,e,2,a)>=7||a.rng()>.28))return;let n=i(t,e).filter(([t,e])=>r(t,e));for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let[t,e]of(n.sort((t,e)=>this._countPlantsInMoore(this.typeName,t[0],t[1],a)-this._countPlantsInMoore(this.typeName,e[0],e[1],a)),n)){if(a.plantGrid[e][t]||!this.canPlantOn(t,e,a)||this._countPlantsInMoore(this.typeName,t,e,a)>=4)continue;this.plant(t,e,a);let r=["mint","teal","gold","rust"],n=l.data.hue,i=n;if(.08>a.rng()){let t=r.filter(t=>t!==n);i=t[Math.floor(a.rng()*t.length)]}a.plantGrid[e][t].data.hue=i;break}.01>a.rng()&&(a.baseGrid[e][t]="sand",a.plantGrid[e][t]=null)}static draw(t,e,a,l){let r=e+10,n=a+10,i=3+2*l.stage;for(let[e,a]of(t.fillStyle=this._hueToColour(l.data.hue),[[0,0],[-3,1],[3,-1],[1,3],[-1,-3]]))t.beginPath(),t.arc(r+e,n+a,i/2,0,2*Math.PI),t.fill();t.strokeStyle="rgba(0,0,0,0.25)",t.lineWidth=1,t.beginPath(),t.arc(r,n,i/2,0,2*Math.PI),t.stroke()}}class b extends g{static typeName="lily";static displayName="Lily";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.colour+" flower)"}static canPlantOn(t,e,a){if("water"!==a.baseGrid[e][t])return!1;let l=0;for(let[n,o]of i(t,e))r(n,o)&&"water"===a.baseGrid[o][n]&&l++;return l>=6}static init(t,e,a){let l=["red","yellow","blue","green","cyan","magenta"];return{colour:l[Math.floor(a.rng()*l.length)],flowering:!1,bloomAge:0,notchAngle:a.rng()*Math.PI*2}}static _colourToRGB(t){return({red:"rgb(255, 70, 70)",yellow:"rgb(255, 235, 90)",blue:"rgb(80, 140, 255)",green:"rgb(90, 255, 130)",cyan:"rgb(90, 245, 255)",magenta:"rgb(255, 90, 235)"})[t]||"rgb(255, 255, 255)"}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%5==0&&(l.stage+=1),l.stage<2))return;if(l.data.flowering){l.data.bloomAge+=1;let t=Math.min(.5,.06*l.data.bloomAge);if(a.rng()<.1+t){l.data.flowering=!1,l.data.bloomAge=0;return}}else .05>a.rng()&&(l.data.flowering=!0,l.data.bloomAge=0);if(!l.data.flowering||l.age%3!=0||this._countPlantsInRadius(this.typeName,t,e,2,a)>=8||a.rng()>.35)return;let n=i(t,e).filter(([t,e])=>r(t,e));for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let[t,e]of n){if(a.plantGrid[e][t]||!this.canPlantOn(t,e,a))continue;this.plant(t,e,a);let r=["red","yellow","blue","green","cyan","magenta"],n=l.data.colour;if(.06>a.rng()){let t=r.filter(t=>t!==l.data.colour);n=t[Math.floor(a.rng()*t.length)]}let i=a.plantGrid[e][t];i.data.colour=n,i.data.flowering=!1,i.data.bloomAge=0;break}}static draw(t,e,a,l){let r=e+10,n=a+10;t.fillStyle="rgb(70, 170, 120)",t.beginPath(),t.ellipse(r,n+2,7,5,0,0,2*Math.PI),t.fill();let i=l.data.notchAngle;if(t.fillStyle="rgba(0,0,0,0.25)",t.beginPath(),t.moveTo(r,n+2),t.arc(r,n+2,7,i-.35,i+.35),t.closePath(),t.fill(),l.data.flowering){for(let[e,a]of(t.fillStyle=this._colourToRGB(l.data.colour),[[0,-5],[5,0],[0,5],[-5,0],[3,-3],[-3,-3],[3,3],[-3,3]]))t.beginPath(),t.arc(r+e,n-3+a,2,0,2*Math.PI),t.fill();t.fillStyle="rgb(255, 235, 90)",t.beginPath(),t.arc(r,n-3,2,0,2*Math.PI),t.fill()}}}class w extends g{static typeName="geranium";static displayName="Geranium";static maxStage=3;static getDescription(t,e,a){let l=a.plantGrid[e][t];return this.displayName+" ("+l.data.colour+")"}static canPlantOn(t,e,a){let l=a.baseGrid[e][t];return"grass"===l||"mud"===l}static init(t,e,a){return{colour:"white"}}static _pickColourWeighted(t){let e=[["white",40],["red",18],["pink",18],["salmon",12],["magenta",10],["purple",10],["lavender",10],["orange",8],["yellow",8],["peach",7],["deepblue",7],["crimson",6],["scarlet",6],["hotpink",5],["violet",5],["blue",3],["teal",2],["black",1],["gold",1]],a=0;for(let[,t]of e)a+=t;let l=t.rng()*a;for(let[t,a]of e)if((l-=a)<=0)return t;return"white"}static _colourToRGB(t){return({white:"rgb(245,245,245)",red:"rgb(230,70,70)",pink:"rgb(240,120,170)",salmon:"rgb(240,140,120)",magenta:"rgb(230,90,220)",purple:"rgb(160,90,230)",lavender:"rgb(210,180,255)",orange:"rgb(245,150,70)",yellow:"rgb(250,235,90)",peach:"rgb(255,190,150)",deepblue:"rgb(55, 29, 250)",crimson:"rgb(190,40,70)",scarlet:"rgb(252, 26, 26)",hotpink:"rgb(255,80,200)",violet:"rgb(170,110,255)",blue:"rgb(90,140,255)",teal:"rgb(90,220,210)",black:"rgb(30,30,30)",gold:"rgb(251, 203, 61)"})[t]||"rgb(245,245,245)"}static onTick(t,e,a){let l=a.plantGrid[e][t];if(!l||(l.age+=1,l.stage<this.maxStage&&l.age%3==0&&(l.stage+=1),l.stage<this.maxStage||l.age%6!=0||this._countPlantsInMoore(this.typeName,t,e,a)>=3))return;let n=i(t,e).filter(([t,e])=>r(t,e));for(let t=n.length-1;t>0;t--){let e=Math.floor(a.rng()*(t+1));[n[t],n[e]]=[n[e],n[t]]}if(n.sort((t,e)=>this._countPlantsInMoore(this.typeName,t[0],t[1],a)-this._countPlantsInMoore(this.typeName,e[0],e[1],a)),a.rng()>.55)return;let o=l.data.colour,s=o;for(let[l,r]of(a.rng()<("white"===o?.14:.08)&&(s=this._pickColourWeighted(a)),n))if(!(this._countPlantsInMoore(this.typeName,l,r,a)>=2)&&this._trySpreadTo(this.typeName,t,e,l,r,this.canPlantOn,a)){a.plantGrid[r][l].data.colour=s;break}}static draw(t,e,a,l){let r=e+10,n=a+10;if(t.lineWidth=2,t.strokeStyle="rgb(60,170,90)",t.beginPath(),t.moveTo(r,a+20-5),t.lineTo(r,n+2),t.stroke(),t.fillStyle="rgb(70,190,110)",t.beginPath(),t.ellipse(r-4,a+20-6,4,2,-.3,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(r+4,a+20-6,4,2,.3,0,2*Math.PI),t.fill(),l.stage<1)return;let i=3+l.stage,o=2+Math.floor(l.stage/2);for(let[e,a]of(t.fillStyle=this._colourToRGB(l.data.colour),[[0,-5],[4,-3],[5,0],[4,3],[0,5],[-4,3],[-5,0],[-4,-3]]))t.beginPath(),t.arc(r+e,n+a,o,0,2*Math.PI),t.fill();t.beginPath(),t.arc(r,n,i,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0,0,0,0.25)",t.beginPath(),t.arc(r,n,Math.max(2,i-2),0,2*Math.PI),t.fill(),t.fillStyle="rgba(255,255,255,0.35)",t.beginPath(),t.arc(r-1,n-1,1,0,2*Math.PI),t.fill()}}class P extends g{static typeName="fence";static displayName="Fence";static maxStage=0;static canPlantOn(t,e,a){return!0}static onTick(t,e,a){}static draw(t,e,a,l){let r=a+5,n=a+20-4,i=e+3+2,o=e+20-3-2;t.fillStyle="rgb(170,140,95)",t.strokeStyle="rgba(0,0,0,0.9)",t.lineWidth=1,t.fillRect(i-1,r,3,n-r),t.fillRect(o-1,r,3,n-r),t.fillRect(i+2,a+9,o-i-3,3),t.fillRect(i+2,a+14,o-i-3,3),t.fillRect(i-2,r-2,5,3),t.fillRect(o-2,r-2,5,3)}}let G={[c.typeName]:c,[d.typeName]:d,[f.typeName]:f,[u.typeName]:u,[h.typeName]:h,[p.typeName]:p,[m.typeName]:m,[y.typeName]:y,[b.typeName]:b,[w.typeName]:w,[P.typeName]:P},M=[d.typeName,c.typeName,f.typeName,u.typeName,h.typeName,m.typeName,y.typeName,b.typeName,w.typeName,p.typeName,P.typeName],N={daisy:30,reed:40,cactus:50,chromatic:80,wanderer:120,blight:200,fence:1,mushroom:60,lichen:40,geranium:60,lily:80};function S(t){let e=0;for(let a=0;a<t.plantGrid.length;a++){let l=t.plantGrid[a];for(let t=0;t<l.length;t++){let a=l[t];if(!a)continue;let r=G[a.plantType];r&&a.stage===r.maxStage&&(e+=Math.ceil(N[a.plantType]/10))}}t.plantGrid=l(),t.magic+=e}function k(t,e,a){return e+Math.floor(t()*(a-e+1))}function T(t){let e=[];for(let a=0;a<30;a++)e.push(t[a].slice());return e}function x(t,e,a,l){let n=0;for(let i=-1;i<=1;i++)for(let o=-1;o<=1;o++){if(0===o&&0===i)continue;let s=e+o,g=a+i;r(s,g)&&t[g][s]===l&&n++}return n}function I(t,e,a,l,n,i,o){let s=l,g=n,c=[[1,0],[-1,0],[0,1],[0,-1]];for(let l=0;l<i;l++){for(let t=-o;t<=o;t++)for(let l=-o;l<=o;l++){let n=s+l,i=g+t;r(n,i)&&(l*l+t*t>o*o||(e[i][n]=a))}let[l,n]=c[k(t,0,c.length-1)];s=Math.max(1,Math.min(38,s+l)),g=Math.max(1,Math.min(28,g+n)),.12>t()&&(o=Math.max(1,Math.min(3,o+(.5>t()?-1:1))))}}function _(t,e){for(let t=0;t<30;t++)for(let a=0;a<40;a++)e[t][a]="grass";{let a=k(t,Math.floor(10),Math.floor(30)),l=k(t,Math.floor(7.5),Math.floor(22.5)),r=k(t,55,85),n=k(t,2,3);I(t,e,"water",a,l,r,n)}if(.55>t()){let a=k(t,2,37),l=k(t,2,27),r=k(t,18,35),n=k(t,1,2);I(t,e,"water",a,l,r,n)}!function(t,e){let a=T(e);for(let l=0;l<30;l++)for(let r=0;r<40;r++)"grass"===e[l][r]&&x(e,r,l,"water")>=1&&.85>t()&&(a[l][r]="sand");let l=T(a);for(let e=0;e<30;e++)for(let r=0;r<40;r++){if("grass"!==a[e][r]&&"sand"!==a[e][r])continue;let n=x(a,r,e,"water"),i=x(a,r,e,"sand");n>=1&&.45>t()?l[e][r]="mud":i>=3&&.22>t()&&(l[e][r]="mud")}for(let t=0;t<30;t++)for(let a=0;a<40;a++)e[t][a]=l[t][a]}(t,e),function(t,e){let a=k(t,2,4),l=[];for(let r=0;r<a;r++){let a=k(t,0,39),r=k(t,0,29);"water"!==e[r][a]&&(x(e,a,r,"water")>0||(e[r][a]="stone",l.push([a,r])))}let n=k(t,35,70);for(let a=0;a<n&&0!==l.length;a++){let a=k(t,0,l.length-1),[n,i]=l[a],o=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]],[s,g]=o[k(t,0,o.length-1)],c=n+s,d=i+g;if(!r(c,d)||"grass"!==e[d][c])continue;let f=x(e,c,d,"stone");if(x(e,c,d,"water")>0)continue;let u=.2+.12*f;t()<u&&(e[d][c]="stone",l.push([c,d])),l.length>120&&.25>t()&&l.splice(a,1)}}(t,e),function(t,e){let a=T(e);for(let l=0;l<30;l++)for(let r=0;r<40;r++){let n=e[l][r];if("water"===n)continue;let i=x(e,r,l,n);if(("sand"===n||"mud"===n||"stone"===n)&&i<=1){if(x(e,r,l,"water")>=2)continue;.85>t()&&(a[l][r]="grass")}"grass"===n&&x(e,r,l,"water")>=6&&.4>t()&&(a[l][r]="water")}for(let t=0;t<30;t++)for(let l=0;l<40;l++)e[t][l]=a[t][l]}(t,e);for(let a=0;a<20;a++){let a=k(t,0,39),l=k(t,0,29);!("grass"!==e[l][a]||x(e,a,l,"water")>0)&&!(x(e,a,l,"stone")>0)&&.15>t()&&(e[l][a]="mud")}for(let a=0;a<30;a++)for(let l=0;l<40;l++)"mud"===e[a][l]&&0===function(t,e,a,l){let n=0;for(let[l,i]of[[1,0],[-1,0],[0,1],[0,-1]]){let o=e+l,s=a+i;r(o,s)&&"mud"===t[s][o]&&n++}return n}(e,l,a,0)&&.7>t()&&(e[a][l]="grass")}function v(t){document.getElementById("magicCount").textContent=String(t)}let C={baseGrid:function(t){let e=[];for(let a=0;a<30;a++){let a=[];for(let e=0;e<40;e++)a.push(t);e.push(a)}return e}("grass"),plantGrid:l(),selectedTool:"tile",selectedValue:"grass",paused:!1,showGrid:!0,seedCounter:1,rng:s(123456),magic:100};_(C.rng,C.baseGrid);let E=document.getElementById("game"),O=E.getContext("2d");E.width=800,E.height=600;let{refreshButtons:R}=function(t,l){let n=document.getElementById("tileButtons"),i=document.getElementById("seedButtons"),o=document.getElementById("tickPill"),s=document.getElementById("gridPill"),g=document.getElementById("magicCount"),c=document.getElementById("inspector");function d(e,a,l,r,n){let i=document.createElement("div");if(i.className="btn",i.dataset.kind=a,i.dataset.value=l,r){let t=document.createElement("div");t.className="swatch",t.style.background=r,i.appendChild(t)}let o=document.createElement("div");if(o.textContent=e,i.appendChild(o),"number"==typeof n){let t=document.createElement("div");t.className="cost",t.textContent=`${n}\u{1D4DC}`,i.appendChild(t)}return i.addEventListener("click",()=>{t.selectedTool=a,t.selectedValue=l,h()}),i}let f=[];for(let t of e){let e=d(t,"tile",t,a[t],1);n.appendChild(e),f.push(e)}let u=[];for(let t of M){let e=G[t],a=N[t]??1,l=d(e.displayName,"seed",t,null,a);i.appendChild(l),u.push(l)}function h(){for(let e of f){let a="tile"===t.selectedTool&&t.selectedValue===e.dataset.value;e.classList.toggle("selected",a)}for(let e of u){let a="seed"===t.selectedTool&&t.selectedValue===e.dataset.value;e.classList.toggle("selected",a)}o.textContent=`Tick: ${t.paused?"paused":"running"}`,s.textContent=`Grid: ${t.showGrid?"on":"off"}`,g.textContent=String(t.magic)}function p(t){let e=l.getBoundingClientRect(),a=t.clientX-e.left,n=t.clientY-e.top,i=Math.floor(a/20),o=Math.floor(n/20);return r(i,o)?[i,o]:null}function m(a,l,n){if(r(a,l)){if(2===n){let e=t.plantGrid[l][a];if(e){let r=G[e.plantType];r&&e.stage===r.maxStage&&(t.magic+=Math.ceil(N[e.plantType]/10)),t.plantGrid[l][a]=null,v(t.magic)}return}if(0===n){if("tile"===t.selectedTool&&e.includes(t.selectedValue)){if(t.baseGrid[l][a]!==t.selectedValue){if(t.magic<1)return;t.magic-=1,g.textContent=String(t.magic)}t.baseGrid[l][a]=t.selectedValue;let e=t.plantGrid[l][a];if(e){let r=G[e.plantType];r&&!r.canPlantOn(a,l,t)&&(t.plantGrid[l][a]=null)}return}if("seed"===t.selectedTool&&G[t.selectedValue]){if(t.plantGrid[l][a])return;let e=G[t.selectedValue];if(!e.canPlantOn(a,l,t))return;let r=N[t.selectedValue]??1;if(t.magic<r)return;t.magic-=r,g.textContent=String(t.magic),e.plant(a,l,t)}}}}function y(t){c&&(c.textContent=t||"")}h(),l.addEventListener("contextmenu",t=>t.preventDefault());let b=!1,w=0,P=null,k=null;return l.addEventListener("mousemove",e=>{let a=p(e);if(!a){null!==k&&(k=null,y(""));return}let[l,n]=a,i=`${l},${n}`;i!==k&&(k=i,y(function(e,a){if(!r(e,a))return"";let l=t.plantGrid[a][e];if(!l)return"";let n=G[l.plantType];return n?"function"==typeof n.getDescription?n.getDescription(e,a,t):n.displayName:""}(l,n)))}),l.addEventListener("mouseleave",()=>{k=null,y("")}),l.addEventListener("mousedown",t=>{let e=p(t);if(!e)return;b=!0,w=t.button,P=null;let[a,l]=e;m(a,l,w),P=`${a},${l}`}),window.addEventListener("mouseup",()=>{b=!1,P=null}),l.addEventListener("mousemove",t=>{if(!b)return;let e=p(t);if(!e)return;let[a,l]=e,r=`${a},${l}`;r!==P&&(m(a,l,w),P=r)}),window.addEventListener("keydown",a=>{if(!a.repeat){if("c"===a.key||"C"===a.key)S(t);else if("r"===a.key||"R"===a.key)S(t),_(t.rng,t.baseGrid);else if("o"===a.key||"O"===a.key)S(t),_(t.rng,t.baseGrid),t.magic=100;else if("g"===a.key||"G"===a.key)t.showGrid=!t.showGrid;else if(" "===a.key)t.paused=!t.paused;else if("1"===a.key||"2"===a.key||"3"===a.key||"4"===a.key){let l=parseInt(a.key,10)-1;l>=0&&l<e.length&&(t.selectedTool="tile",t.selectedValue=e[l])}else"q"===a.key||"Q"===a.key?(t.selectedTool="seed",t.selectedValue=M[0]):"w"===a.key||"W"===a.key?(t.selectedTool="seed",t.selectedValue=M[1]):("e"===a.key||"E"===a.key)&&(t.selectedTool="seed",t.selectedValue=M[2]);h()}}),{refreshButtons:h}}(C,E);!function(a){let l=localStorage.getItem(t);if(l)try{let t=JSON.parse(l);if(Array.isArray(t.base)&&30===t.base.length)for(let l=0;l<30;l++){let r=t.base[l];if(Array.isArray(r)&&40===r.length)for(let t=0;t<40;t++){let n=r[t];a.baseGrid[l][t]=e.includes(n)?n:"grass"}}if(Array.isArray(t.plants)&&30===t.plants.length)for(let e=0;e<30;e++){let l=t.plants[e];if(Array.isArray(l)&&40===l.length)for(let t=0;t<40;t++){let r=l[t];if(null===r||!r||"object"!=typeof r){a.plantGrid[e][t]=null;continue}let n=r.plantType;if(!n||!G[n]){a.plantGrid[e][t]=null;continue}a.plantGrid[e][t]={plantType:n,stage:o(0|r.stage,0,99),age:o(0|r.age,0,999999),data:r.data}}}"number"==typeof t.magic&&(a.magic=Math.max(0,Math.floor(t.magic)))}catch(t){}}(C),R(),setInterval(()=>{C.paused||(!function(t){let e=[];for(let a=0;a<30;a++)for(let l=0;l<40;l++)t.plantGrid[a][l]&&e.push([l,a]);for(let[a,l]of(t.rng=s(Date.now()+t.seedCounter|0),t.seedCounter++,e)){let e=t.plantGrid[l][a];if(!e)continue;let r=G[e.plantType];if(!r||!r.canPlantOn(a,l,t)){t.plantGrid[l][a]=null;continue}r.onTick(a,l,t)}}(C),v(C.magic))},1e3),!function t(){!function(t,e){for(let l=0;l<30;l++)for(let r=0;r<40;r++)e.fillStyle=a[t.baseGrid[l][r]]||"#777",e.fillRect(20*r,20*l,20,20);if(t.showGrid){e.strokeStyle="rgba(0,0,0,0.65)",e.lineWidth=1;for(let t=0;t<=40;t++){let a=20*t+.5;e.beginPath(),e.moveTo(a,0),e.lineTo(a,600),e.stroke()}for(let t=0;t<=30;t++){let a=20*t+.5;e.beginPath(),e.moveTo(0,a),e.lineTo(800,a),e.stroke()}}for(let a=0;a<30;a++)for(let l=0;l<40;l++){let r=t.plantGrid[a][l];if(!r)continue;let n=G[r.plantType];n&&n.draw(e,20*l,20*a,r)}}(C,O),requestAnimationFrame(t)}(),window.addEventListener("beforeunload",()=>{let e;e={w:40,h:30,base:C.baseGrid,plants:C.plantGrid,magic:C.magic},localStorage.setItem(t,JSON.stringify(e))});
//# sourceMappingURL=garden.0123907f.js.map
